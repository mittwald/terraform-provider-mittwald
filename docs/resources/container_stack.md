---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "mittwald_container_stack Resource - terraform-provider-mittwald"
subcategory: ""
description: |-
  This resource models a container stack.
  A container stack may consist of multiple containers and volumes.
  IMPORTANT: Currently, the mStudio API supports one "default" stack per project. In the future, support for multiple stacks within the same project will be added.
  This resource's API already pre-empts this functionality; however, at the moment, you can only manage containers in a project's default stack. To use the default stack, set the default_stack attribute to true.
---

# mittwald_container_stack (Resource)

This resource models a container stack.

A container stack may consist of multiple containers and volumes.

**IMPORTANT**: Currently, the mStudio API supports one "default" stack per project. In the future, support for multiple stacks within the same project will be added.

This resource's API already pre-empts this functionality; however, at the moment, you can only manage containers in a project's default stack. To use the default stack, set the `default_stack` attribute to `true`.

## Example Usage

```terraform
locals {
  nginx_port = 80
}

resource "mittwald_container_stack" "nginx" {
  project_id    = mittwald_project.example.id
  default_stack = true

  containers = {
    nginx = {
      description = "Example web server"
      image       = "nginx:1.27.4"

      // entrypoint and command *must* be specified, even if they are the defaults.
      // To dynamically determine the default entrypoint and command, use the
      // `mittwald_container_image` data source.
      entrypoint = ["/docker-entrypoint.sh"]
      command    = ["nginx", "-g", "daemon off;"]

      // environment = {
      //   FOO = "bar"
      // }

      ports = [
        {
          container_port = 80
          public_port    = local.nginx_port
          protocol       = "tcp"
        }
      ]

      // Resource limits for the container
      limits = {
        cpus   = 0.5
        memory = "512mb"
      }

      // Example of mounting a project path and a stack volume
      // EITHER "project_path" OR "volume" must be specified in each volume block
      volumes = [
        {
          project_path = "/html"
          mount_path   = "/usr/share/nginx/html"
        },
        {
          volume     = "example"
          mount_path = "/mnt/example"
        }
      ]
    }
  }

  volumes = {
    example = {}
  }
}

resource "mittwald_virtualhost" "nginx" {
  hostname   = "${mittwald_project.test.short_id}.project.space"
  project_id = mittwald_project.test.id

  paths = {
    "/" = {
      container = {
        container_id = mittwald_container_stack.nginx.containers.nginx.id
        port         = "${local.nginx_port}/tcp"
      }
    }
  }
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `containers` (Attributes Map) (see [below for nested schema](#nestedatt--containers))
- `project_id` (String) The ID of the project the container_stack belongs to. Must be a full UUID (not a short ID like p-XXXXXX).

### Optional

- `default_stack` (Boolean) Set this flag to use the project's default stack. Otherwise, a new stack will be created.
- `volumes` (Attributes Map) A map of volumes that should be provisioned for this stack. (see [below for nested schema](#nestedatt--volumes))

### Read-Only

- `id` (String) The generated container_stack ID

<a id="nestedatt--containers"></a>
### Nested Schema for `containers`

Required:

- `command` (List of String) The command to run inside the container.

    Note that this is a required value, even if the image already has a default command. To use the default command, use the `mittwald_container_image` data source to first determine the default command, and then use that value here.
- `description` (String) A description for the container.
- `entrypoint` (List of String) The entrypoint to use for the container.

    Note that this is a required value, even if the image already has a default entrypoint. To use the default entrypoint, use the `mittwald_container_image` data source to first determine the default entrypoint, and then use that value here.
- `image` (String) The image to use for the container. Follows the usual Docker image format, e.g. `nginx:latest` or `registry.example.com/my-image:latest`.

      Note that when using a non-standard registry (or a standard registry with credentials), you will probably also need to add a `mittwald_container_registry` resource somewhere in your plan.

Optional:

- `environment` (Map of String) A map of environment variables to set inside the container.
- `limits` (Attributes) Resource limitations for the container. (see [below for nested schema](#nestedatt--containers--limits))
- `no_recreate_on_change` (Boolean, [Write-only](https://developer.hashicorp.com/terraform/language/resources/ephemeral#write-only-arguments)) Set this flag to **not** recreate the container if any of the configuration changes. This includes changes to the image, command, entrypoint, environment variables, and ports. If this is set, you will need to manually recreate the container to apply any changes.
- `ports` (Attributes Set) A port to expose from the container. (see [below for nested schema](#nestedatt--containers--ports))
- `volumes` (Attributes Set) Volumes to mount into the container. (see [below for nested schema](#nestedatt--containers--volumes))

Read-Only:

- `id` (String) The generated container ID

<a id="nestedatt--containers--limits"></a>
### Nested Schema for `containers.limits`

Optional:

- `cpus` (Number) CPU limit as a decimal number of CPU cores (e.g., 0.5 for half a core, 2 for two cores).
- `memory` (String) Memory limit as a formatted string following Docker Compose specification (e.g., "512mb", "1gb", "50m"). Valid suffixes are b (bytes), k or kb (kilo bytes), m or mb (mega bytes), and g or gb (giga bytes).


<a id="nestedatt--containers--ports"></a>
### Nested Schema for `containers.ports`

Required:

- `container_port` (Number) The container port to expose.

Optional:

- `protocol` (String) The protocol to use for the port. Currently, the only supported value is `tcp`, which is also the default.
- `public_port` (Number) The public port to expose; when omitted, this will default to the same value as `container_port`.


<a id="nestedatt--containers--volumes"></a>
### Nested Schema for `containers.volumes`

Required:

- `mount_path` (String) The path to mount the volume to.

Optional:

- `project_path` (String) Path to a directory in the project filesystem.

    Either this attribute, or `volume` must be set.
- `volume` (String) The name of the volume to mount. A volume of this name must be specified in the top-level `volumes` attribute.

    Either this attribute, or `project_path` must be set.



<a id="nestedatt--volumes"></a>
### Nested Schema for `volumes`
